package com.cultome.bizlang.language.function;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.junit.Assert.assertNull;
import static org.junit.Assert.assertTrue;

import java.math.BigDecimal;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.junit.Before;
import org.junit.Test;

import com.cultome.bizlang.dataaccess.WSReader;
import com.cultome.bizlang.language.BizlangException;
import com.cultome.bizlang.language.BizlangValue;
import com.cultome.bizlang.language.parser.BizlangLexer;
import com.cultome.bizlang.language.util.Utils;
import com.cultomebizlang.language.interpreter.Bindings;

public class GetFromWsFunctionTest {
	
	private GetFromWsFunction function;
	private Bindings bindings;

	@Before
	public void setUp() throws Exception {
		function = new GetFromWsFunction();
		bindings = new Bindings();
		bindings.addBinding("resourceName", "token");
		bindings.addBinding("token", "mytoken");
		
		Map<String, Object> wsConfig = new HashMap<String, Object>();
		HashMap<String, String> headers = new HashMap<String, String>();
		headers.put("BIZLANG_TOKEN", "{token}");
		
		wsConfig.put(GetFromWsFunction.ENDPOINT_PROPERTY, "http://localhost:8080/bizlang-ws/{resourceName}s");
		wsConfig.put(GetFromWsFunction.HTTP_METHOD_PROPERTY, "gEt");
//		wsConfig.put(GetFromWsFunction.CONTENT_PROPERTY, null);
		wsConfig.put(GetFromWsFunction.HEADERS_PROPERTY, headers);
		
		bindings.addConfig(Bindings.CNFG_NS_WEBSERVICES, GetFromWsFunction.ACCESSOR, WSReader.getInstance());
		bindings.addConfig(Bindings.CNFG_NS_WEBSERVICES, "myWs", wsConfig);
	}

	@SuppressWarnings("unchecked")
	@Test
	public void testExecute() throws BizlangException {
		Map<String, Object> r = (Map<String, Object>) function.execute(bindings, new BizlangValue(BizlangLexer.STR, "myWs", 1));
		assertNotNull(r);
		assertEquals(new BigDecimal(1), (BigDecimal) Utils.getPropertyFrom(r, "tokens.token[0].id"));
	}
	
	@SuppressWarnings("rawtypes")
	@Test
	public void testParseXmlLicenses(){
		String xml = "<S:Envelope xmlns:S=\"http://schemas.xmlsoap.org/soap/envelope/\"><S:Body><ns2:getLicenseByCountryCdResponse xmlns:ns2=\"http://ws.gcp.international.fedex.com/\"><return><action>0</action><countryCd>MX</countryCd><licenseCd>3018</licenseCd><licenseOidNbr>348</licenseOidNbr><licenseOwnerNm>AA GREGORIO A GIACINTI VALDES</licenseOwnerNm><licensePortList><action>0</action><clearanceLocationCd>MTY</clearanceLocationCd><licenseOidNbr>348</licenseOidNbr><licensePortOidNbr>412</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>GDL</clearanceLocationCd><licenseOidNbr>348</licenseOidNbr><licensePortOidNbr>411</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>TLC</clearanceLocationCd><licenseOidNbr>348</licenseOidNbr><licensePortOidNbr>410</licensePortOidNbr></licensePortList></return><return><action>0</action><countryCd>MX</countryCd><licenseCd>3914</licenseCd><licenseOidNbr>357</licenseOidNbr><licenseOwnerNm>AA NIDIA THELMA HERNANDEZ DIAZ</licenseOwnerNm><licensePortList><action>0</action><clearanceLocationCd>GDL</clearanceLocationCd><licenseOidNbr>357</licenseOidNbr><licensePortOidNbr>429</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>TLC</clearanceLocationCd><licenseOidNbr>357</licenseOidNbr><licensePortOidNbr>430</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>MTY</clearanceLocationCd><licenseOidNbr>357</licenseOidNbr><licensePortOidNbr>431</licensePortOidNbr></licensePortList></return><return><action>0</action><countryCd>MX</countryCd><licenseCd>110</licenseCd><licenseOidNbr>2241</licenseOidNbr><licenseOwnerNm>ABC BROKERAGE</licenseOwnerNm><licensePortList><action>0</action><clearanceLocationCd>GDL</clearanceLocationCd><licenseOidNbr>2241</licenseOidNbr><licensePortOidNbr>6683</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>TLC</clearanceLocationCd><licenseOidNbr>2241</licenseOidNbr><licensePortOidNbr>6684</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>BRA</clearanceLocationCd><licenseOidNbr>2241</licenseOidNbr><licensePortOidNbr>6681</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>CUN</clearanceLocationCd><licenseOidNbr>2241</licenseOidNbr><licensePortOidNbr>6682</licensePortOidNbr></licensePortList></return><return><action>0</action><countryCd>MX</countryCd><licenseCd>ABX</licenseCd><licenseOidNbr>360</licenseOidNbr><licenseOwnerNm>ABX LOGISCICS MEXICO</licenseOwnerNm><licensePortList><action>0</action><clearanceLocationCd>MTY</clearanceLocationCd><licenseOidNbr>360</licenseOidNbr><licensePortOidNbr>438</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>TLC</clearanceLocationCd><licenseOidNbr>360</licenseOidNbr><licensePortOidNbr>436</licensePortOidNbr></licensePortList><licensePortList><action>0</action><clearanceLocationCd>GDL</clearanceLocationCd><licenseOidNbr>360</licenseOidNbr><licensePortOidNbr>437</licensePortOidNbr></licensePortList></return><return><action>0</action><countryCd>MX</countryCd><licenseCd>3088</licenseCd><licenseOidNbr>121</licenseOidNbr><licenseOwnerNm>ADRIAN LLAMAS TAPIA</licenseOwnerNm><licensePortList><action>0</action><clearanceLocationCd>GDL</clearanceLocationCd><licenseOidNbr>121</licenseOidNbr><licensePortOidNbr>181</licensePortOidNbr></licensePortList></return></ns2:getLicenseByCountryCdResponse></S:Body></S:Envelope>";
		Map<String, Object> r = function.parseXml(xml);
		assertNotNull(r);
		Object env = r.get("Envelope");
		assertTrue(env instanceof Map);
		Object body = ((Map) env).get("Body");
		assertTrue(body instanceof Map);
		Object license = ((Map) body).get("getLicenseByCountryCdResponse");
		assertTrue(license instanceof Map);
		Object rets = ((Map) license).get("return");
		assertTrue(rets instanceof List);
		Object elem = ((List) rets).get(0);
		assertTrue(elem instanceof Map);
		Object value = ((Map) elem).get("licenseOwnerNm");
		assertTrue(value instanceof String);
		Object ports = ((Map) elem).get("licensePortList");
		assertTrue(ports instanceof List);
		Object port = ((List) ports).get(0);
		assertTrue(port instanceof Map);
		Object location = ((Map) port).get("clearanceLocationCd");
		assertTrue(location instanceof String);
		
	}
	
	@SuppressWarnings("rawtypes")
	@Test
	public void testParseXmlCountries(){
		String xml = "<?xml version='1.0' encoding='UTF-8'?><S:Envelope xmlns:S=\"http://schemas.xmlsoap.org/soap/envelope/\"><S:Body><ns2:getCountryListResponse xmlns:ns2=\"http://ws.gcp.international.fedex.com/\"><return><action>0</action><countryCode>AF</countryCode><countryName>AFGHANISTAN</countryName></return><return><action>0</action><countryCode>AL</countryCode><countryName>ALBANIA</countryName></return><return><action>0</action><countryCode>DZ</countryCode><countryName>ALGERIA</countryName></return><return><action>0</action><countryCode>AS</countryCode><countryName>AMERICAN-SAMOA</countryName></return><return><action>0</action><countryCode>AD</countryCode><countryName>ANDORRA</countryName></return><return><action>0</action><countryCode>AO</countryCode><countryName>ANGOLA</countryName></return><return><action>0</action><countryCode>AI</countryCode><countryName>ANGUILLA</countryName></return><return><action>0</action><countryCode>AG</countryCode><countryName>ANTIGUABARBUDA</countryName></return><return><action>0</action><countryCode>AR</countryCode><countryName>ARGENTINA</countryName></return><return><action>0</action><countryCode>AM</countryCode><countryName>ARMENIA</countryName></return><return><action>0</action><countryCode>AW</countryCode><countryName>ARUBA</countryName></return><return><action>0</action><countryCode>AU</countryCode><countryName>AUSTRALIA</countryName></return><return><action>0</action><countryCode>AT</countryCode><countryName>AUSTRIA</countryName></return><return><action>0</action><countryCode>AZ</countryCode><countryName>AZERBAIJAN</countryName></return><return><action>0</action><countryCode>BH</countryCode><countryName>BAHRAIN</countryName></return><return><action>0</action><countryCode>BD</countryCode><countryName>BANGLADESH</countryName></return><return><action>0</action><countryCode>BB</countryCode><countryName>BARBADOS</countryName></return><return><action>0</action><countryCode>BY</countryCode><countryName>BELARUS</countryName></return><return><action>0</action><countryCode>BE</countryCode><countryName>BELGIUM</countryName></return><return><action>0</action><countryCode>BZ</countryCode><countryName>BELIZE</countryName></return><return><action>0</action><countryCode>BJ</countryCode><countryName>BENIN</countryName></return><return><action>0</action><countryCode>BM</countryCode><countryName>BERMUDA</countryName></return><return><action>0</action><countryCode>BT</countryCode><countryName>BHUTAN</countryName></return><return><action>0</action><countryCode>BO</countryCode><countryName>BOLIVIA</countryName></return><return><action>0</action><countryCode>BA</countryCode><countryName>BOSNIAHERZOGOVINA</countryName></return><return><action>0</action><countryCode>BW</countryCode><countryName>BOTSWANA</countryName></return><return><action>0</action><countryCode>BR</countryCode><countryName>BRAZIL</countryName></return><return><action>0</action><countryCode>VG</countryCode><countryName>BRITISH VIRGIN ISLANDS</countryName></return><return><action>0</action><countryCode>BN</countryCode><countryName>BRUNEI</countryName></return><return><action>0</action><countryCode>BG</countryCode><countryName>BULGARIA</countryName></return><return><action>0</action><countryCode>BF</countryCode><countryName>BURKINA FASO</countryName></return><return><action>0</action><countryCode>BI</countryCode><countryName>BURUNDI</countryName></return><return><action>0</action><countryCode>SU</countryCode><countryName>C.I.S.</countryName></return><return><action>0</action><countryCode>KH</countryCode><countryName>CAMBODIA</countryName></return><return><action>0</action><countryCode>CM</countryCode><countryName>CAMEROON</countryName></return><return><action>0</action><countryCode>CA</countryCode><countryName>CANADA</countryName></return><return><action>0</action><countryCode>CV</countryCode><countryName>CAPE-VERDE</countryName></return><return><action>0</action><countryCode>KY</countryCode><countryName>CAYMAN ISLANDS</countryName></return><return><action>0</action><countryCode>CF</countryCode><countryName>CENTRAL-AFRICAN REPUBLIC</countryName></return><return><action>0</action><countryCode>TD</countryCode><countryName>CHAD</countryName></return><return><action>0</action><countryCode>CL</countryCode><countryName>CHILE</countryName></return><return><action>0</action><countryCode>CN</countryCode><countryName>CHINA</countryName></return><return><action>0</action><countryCode>CO</countryCode><countryName>COLOMBIA</countryName></return><return><action>0</action><countryCode>CG</countryCode><countryName>CONGO</countryName></return><return><action>0</action><countryCode>CK</countryCode><countryName>COOK ISLANDS</countryName></return><return><action>0</action><countryCode>CR</countryCode><countryName>COSTA RICA</countryName></return><return><action>0</action><countryCode>HR</countryCode><countryName>CROATIA</countryName></return><return><action>0</action><countryCode>CY</countryCode><countryName>CYPRUS</countryName></return><return><action>0</action><countryCode>CZ</countryCode><countryName>CZECH REPUBLIC</countryName></return><return><action>0</action><countryCode>CD</countryCode><countryName>DEMOCRATIC REP. CONGO</countryName></return><return><action>0</action><countryCode>DK</countryCode><countryName>DENMARK</countryName></return><return><action>0</action><countryCode>DJ</countryCode><countryName>DJIBOUTI</countryName></return><return><action>0</action><countryCode>DM</countryCode><countryName>DOMINICA</countryName></return><return><action>0</action><countryCode>DO</countryCode><countryName>DOMINICAN REPUBLIC</countryName></return><return><action>0</action><countryCode>TL</countryCode><countryName>EAST TIMOR</countryName></return><return><action>0</action><countryCode>EC</countryCode><countryName>ECUADOR</countryName></return><return><action>0</action><countryCode>EG</countryCode><countryName>EGYPT</countryName></return><return><action>0</action><countryCode>SV</countryCode><countryName>EL SALVADOR</countryName></return><return><action>0</action><countryCode>GQ</countryCode><countryName>EQUATORIAL GUINEA</countryName></return><return><action>0</action><countryCode>ER</countryCode><countryName>ERITREA</countryName></return><return><action>0</action><countryCode>EE</countryCode><countryName>ESTONIA</countryName></return><return><action>0</action><countryCode>ET</countryCode><countryName>ETHIOPIA</countryName></return><return><action>0</action><countryCode>FO</countryCode><countryName>FAROE ISLANDS</countryName></return><return><action>0</action><countryCode>FJ</countryCode><countryName>FIJI</countryName></return><return><action>0</action><countryCode>FI</countryCode><countryName>FINLAND</countryName></return><return><action>0</action><countryCode>FR</countryCode><countryName>FRANCE</countryName></return><return><action>0</action><countryCode>GF</countryCode><countryName>FRENCH GUIANA</countryName></return><return><action>0</action><countryCode>PF</countryCode><countryName>FRENCH POLYNESIA</countryName></return><return><action>0</action><countryCode>GA</countryCode><countryName>GABON</countryName></return><return><action>0</action><countryCode>GE</countryCode><countryName>GEORGIA</countryName></return><return><action>0</action><countryCode>DE</countryCode><countryName>GERMANY</countryName></return><return><action>0</action><countryCode>GH</countryCode><countryName>GHANA</countryName></return><return><action>0</action><countryCode>GI</countryCode><countryName>GIBRALTAR</countryName></return><return><action>0</action><countryCode>GR</countryCode><countryName>GREECE</countryName></return><return><action>0</action><countryCode>GL</countryCode><countryName>GREENLAND</countryName></return><return><action>0</action><countryCode>GD</countryCode><countryName>GRENADA</countryName></return><return><action>0</action><countryCode>GP</countryCode><countryName>GUADELOUPE</countryName></return><return><action>0</action><countryCode>GU</countryCode><countryName>GUAM</countryName></return><return><action>0</action><countryCode>GT</countryCode><countryName>GUATEMALA</countryName></return><return><action>0</action><countryCode>GN</countryCode><countryName>GUINEA</countryName></return><return><action>0</action><countryCode>GW</countryCode><countryName>GUINEA-BISSAU</countryName></return><return><action>0</action><countryCode>GY</countryCode><countryName>GUYANA</countryName></return><return><action>0</action><countryCode>HT</countryCode><countryName>HAITI</countryName></return><return><action>0</action><countryCode>HN</countryCode><countryName>HONDURAS</countryName></return><return><action>0</action><countryCode>HK</countryCode><countryName>HONG KONG</countryName></return><return><action>0</action><countryCode>HU</countryCode><countryName>HUNGARY</countryName></return><return><action>0</action><countryCode>IS</countryCode><countryName>ICELAND</countryName></return><return><action>0</action><countryCode>IN</countryCode><countryName>INDIA</countryName></return><return><action>0</action><countryCode>ID</countryCode><countryName>INDONESIA</countryName></return><return><action>0</action><countryCode>IR</countryCode><countryName>IRAN</countryName></return><return><action>0</action><countryCode>IQ</countryCode><countryName>IRAQ</countryName></return><return><action>0</action><countryCode>IE</countryCode><countryName>IRELAND</countryName></return><return><action>0</action><countryCode>IL</countryCode><countryName>ISRAEL</countryName></return><return><action>0</action><countryCode>IT</countryCode><countryName>ITALY</countryName></return><return><action>0</action><countryCode>CI</countryCode><countryName>IVORY COAST</countryName></return><return><action>0</action><countryCode>JM</countryCode><countryName>JAMAICA</countryName></return><return><action>0</action><countryCode>JP</countryCode><countryName>JAPAN</countryName></return><return><action>0</action><countryCode>JO</countryCode><countryName>JORDAN</countryName></return><return><action>0</action><countryCode>KZ</countryCode><countryName>KAZAKHSTAN</countryName></return><return><action>0</action><countryCode>KE</countryCode><countryName>KENYA</countryName></return><return><action>0</action><countryCode>KI</countryCode><countryName>KIRIBATI</countryName></return><return><action>0</action><countryCode>KW</countryCode><countryName>KUWAIT</countryName></return><return><action>0</action><countryCode>KG</countryCode><countryName>KYRGYZSTAN</countryName></return><return><action>0</action><countryCode>LA</countryCode><countryName>LAOS</countryName></return><return><action>0</action><countryCode>LV</countryCode><countryName>LATVIA</countryName></return><return><action>0</action><countryCode>LB</countryCode><countryName>LEBANON</countryName></return><return><action>0</action><countryCode>LS</countryCode><countryName>LESOTHO</countryName></return><return><action>0</action><countryCode>LR</countryCode><countryName>LIBERIA</countryName></return><return><action>0</action><countryCode>LY</countryCode><countryName>LIBYA</countryName></return><return><action>0</action><countryCode>LI</countryCode><countryName>LIECHTENSTEIN</countryName></return><return><action>0</action><countryCode>LT</countryCode><countryName>LITHUANIA</countryName></return><return><action>0</action><countryCode>LU</countryCode><countryName>LUXEMBOURG</countryName></return><return><action>0</action><countryCode>MO</countryCode><countryName>MACAU</countryName></return><return><action>0</action><countryCode>MK</countryCode><countryName>MACEDONIA</countryName></return><return><action>0</action><countryCode>MG</countryCode><countryName>MADAGASCAR</countryName></return><return><action>0</action><countryCode>MW</countryCode><countryName>MALAWI</countryName></return><return><action>0</action><countryCode>MY</countryCode><countryName>MALAYSIA</countryName></return><return><action>0</action><countryCode>MV</countryCode><countryName>MALDIVES</countryName></return><return><action>0</action><countryCode>ML</countryCode><countryName>MALI</countryName></return><return><action>0</action><countryCode>MT</countryCode><countryName>MALTA</countryName></return><return><action>0</action><countryCode>MH</countryCode><countryName>MARSHALL ISLANDS</countryName></return><return><action>0</action><countryCode>MQ</countryCode><countryName>MARTINIQUE</countryName></return><return><action>0</action><countryCode>MR</countryCode><countryName>MAURITANIA</countryName></return><return><action>0</action><countryCode>MU</countryCode><countryName>MAURITIUS</countryName></return><return><action>0</action><countryCode>FM</countryCode><countryName>MICRONESIA</countryName></return><return><action>0</action><countryCode>MD</countryCode><countryName>MOLDOVA</countryName></return><return><action>0</action><countryCode>MC</countryCode><countryName>MONACO</countryName></return><return><action>0</action><countryCode>MN</countryCode><countryName>MONGOLIA</countryName></return><return><action>0</action><countryCode>MS</countryCode><countryName>MONTSERRAT</countryName></return><return><action>0</action><countryCode>MA</countryCode><countryName>MOROCCO</countryName></return><return><action>0</action><countryCode>MZ</countryCode><countryName>MOZAMBIQUE</countryName></return><return><action>0</action><countryCode>MM</countryCode><countryName>MYANMAR</countryName></return><return><action>0</action><countryCode>MX</countryCode><countryName>Mexico</countryName></return><return><action>0</action><countryCode>NA</countryCode><countryName>NAMIBIA</countryName></return><return><action>0</action><countryCode>NR</countryCode><countryName>NAURU</countryName></return><return><action>0</action><countryCode>NP</countryCode><countryName>NEPAL</countryName></return><return><action>0</action><countryCode>NL</countryCode><countryName>NETHERLANDS</countryName></return><return><action>0</action><countryCode>AN</countryCode><countryName>NETHERLANDS ANTILLES</countryName></return><return><action>0</action><countryCode>NC</countryCode><countryName>NEW CALEDONIA</countryName></return><return><action>0</action><countryCode>NZ</countryCode><countryName>NEW ZEALAND</countryName></return><return><action>0</action><countryCode>NI</countryCode><countryName>NICARAGUA</countryName></return><return><action>0</action><countryCode>NE</countryCode><countryName>NIGER</countryName></return><return><action>0</action><countryCode>NG</countryCode><countryName>NIGERIA</countryName></return><return><action>0</action><countryCode>NU</countryCode><countryName>NIUE</countryName></return><return><action>0</action><countryCode>IX</countryCode><countryName>NORTHERN IRELAND</countryName></return><return><action>0</action><countryCode>NO</countryCode><countryName>NORWAY</countryName></return><return><action>0</action><countryCode>OM</countryCode><countryName>OMAN</countryName></return><return><action>0</action><countryCode>PK</countryCode><countryName>PAKISTAN</countryName></return><return><action>0</action><countryCode>PW</countryCode><countryName>PALAU</countryName></return><return><action>0</action><countryCode>PS</countryCode><countryName>PALESTINE AUTONOMOUS</countryName></return><return><action>0</action><countryCode>PA</countryCode><countryName>PANAMA</countryName></return><return><action>0</action><countryCode>PG</countryCode><countryName>PAPUA NEW GUINEA</countryName></return><return><action>0</action><countryCode>PY</countryCode><countryName>PARAGUAY</countryName></return><return><action>0</action><countryCode>PE</countryCode><countryName>PERU</countryName></return><return><action>0</action><countryCode>PH</countryCode><countryName>PHILIPPINES</countryName></return><return><action>0</action><countryCode>PL</countryCode><countryName>POLAND</countryName></return><return><action>0</action><countryCode>PT</countryCode><countryName>PORTUGAL</countryName></return><return><action>0</action><countryCode>QA</countryCode><countryName>QATAR</countryName></return><return><action>0</action><countryCode>RE</countryCode><countryName>REUNION</countryName></return><return><action>0</action><countryCode>RO</countryCode><countryName>ROMANIA</countryName></return><return><action>0</action><countryCode>RU</countryCode><countryName>RUSSIA</countryName></return><return><action>0</action><countryCode>RW</countryCode><countryName>RWANDA</countryName></return><return><action>0</action><countryCode>KN</countryCode><countryName>SAINT KITTS AND NEVIS</countryName></return><return><action>0</action><countryCode>LC</countryCode><countryName>SAINT LUCIA</countryName></return><return><action>0</action><countryCode>VC</countryCode><countryName>SAINT VINCENT AND GRENADINES</countryName></return><return><action>0</action><countryCode>MP</countryCode><countryName>SAIPAN</countryName></return><return><action>0</action><countryCode>SA</countryCode><countryName>SAUDI ARABIA</countryName></return><return><action>0</action><countryCode>SN</countryCode><countryName>SENEGAL</countryName></return><return><action>0</action><countryCode>CS</countryCode><countryName>SERBIA AND MONTENEGRO</countryName></return><return><action>0</action><countryCode>SC</countryCode><countryName>SEYCHELLES</countryName></return><return><action>0</action><countryCode>SL</countryCode><countryName>SIERRA LEONE</countryName></return><return><action>0</action><countryCode>SG</countryCode><countryName>SINGAPORE</countryName></return><return><action>0</action><countryCode>SK</countryCode><countryName>SLOVAK REPLUBLIC</countryName></return><return><action>0</action><countryCode>SI</countryCode><countryName>SLOVENIA</countryName></return><return><action>0</action><countryCode>SB</countryCode><countryName>SOLOMON ISLANDS</countryName></return><return><action>0</action><countryCode>SO</countryCode><countryName>SOMALIA</countryName></return><return><action>0</action><countryCode>ZA</countryCode><countryName>SOUTH AFRICA</countryName></return><return><action>0</action><countryCode>KR</countryCode><countryName>SOUTH KOREA</countryName></return><return><action>0</action><countryCode>ES</countryCode><countryName>SPAIN</countryName></return><return><action>0</action><countryCode>LK</countryCode><countryName>SRI LANKA</countryName></return><return><action>0</action><countryCode>SD</countryCode><countryName>SUDAN</countryName></return><return><action>0</action><countryCode>SR</countryCode><countryName>SURINAME</countryName></return><return><action>0</action><countryCode>SZ</countryCode><countryName>SWAZILAND</countryName></return><return><action>0</action><countryCode>SE</countryCode><countryName>SWEDEN</countryName></return><return><action>0</action><countryCode>CH</countryCode><countryName>SWITZERLAND</countryName></return><return><action>0</action><countryCode>SY</countryCode><countryName>SYRIA</countryName></return><return><action>0</action><countryCode>TW</countryCode><countryName>TAIWAN</countryName></return><return><action>0</action><countryCode>TZ</countryCode><countryName>TANZANIA</countryName></return><return><action>0</action><countryCode>TH</countryCode><countryName>THAILAND</countryName></return><return><action>0</action><countryCode>BS</countryCode><countryName>THE BAHAMAS</countryName></return><return><action>0</action><countryCode>GM</countryCode><countryName>THE GAMBIA</countryName></return><return><action>0</action><countryCode>TG</countryCode><countryName>TOGO</countryName></return><return><action>0</action><countryCode>TO</countryCode><countryName>TONGA</countryName></return><return><action>0</action><countryCode>TT</countryCode><countryName>TRINIDAD AND TOBAGO</countryName></return><return><action>0</action><countryCode>TN</countryCode><countryName>TUNISIA</countryName></return><return><action>0</action><countryCode>TR</countryCode><countryName>TURKEY</countryName></return><return><action>0</action><countryCode>TM</countryCode><countryName>TURKMENISTAN</countryName></return><return><action>0</action><countryCode>TC</countryCode><countryName>TURKS AND CAICOS ISLANDS</countryName></return><return><action>0</action><countryCode>TV</countryCode><countryName>TUVALU</countryName></return><return><action>0</action><countryCode>VI</countryCode><countryName>U S VIRGIN ISLANDS</countryName></return><return><action>0</action><countryCode>UG</countryCode><countryName>UGANDA</countryName></return><return><action>0</action><countryCode>UA</countryCode><countryName>UKRAINE</countryName></return><return><action>0</action><countryCode>AE</countryCode><countryName>UNITED ARAB EMIRATES</countryName></return><return><action>0</action><countryCode>GB</countryCode><countryName>UNITED KINGDOM</countryName></return><return><action>0</action><countryCode>US</countryCode><countryName>UNITED STATES</countryName></return><return><action>0</action><countryCode>UY</countryCode><countryName>URUGUAY</countryName></return><return><action>0</action><countryCode>UZ</countryCode><countryName>UZBEKISTAN</countryName></return><return><action>0</action><countryCode>VU</countryCode><countryName>VANUATU</countryName></return><return><action>0</action><countryCode>VA</countryCode><countryName>VATICAN CITY</countryName></return><return><action>0</action><countryCode>VE</countryCode><countryName>VENEZUELA</countryName></return><return><action>0</action><countryCode>VN</countryCode><countryName>VIET NAM</countryName></return><return><action>0</action><countryCode>WF</countryCode><countryName>WALLIS &amp; FUTUNA</countryName></return><return><action>0</action><countryCode>WS</countryCode><countryName>WESTERN SAMOA</countryName></return><return><action>0</action><countryCode>YE</countryCode><countryName>YEMEN</countryName></return><return><action>0</action><countryCode>YU</countryCode><countryName>YUGOSLAVIA</countryName></return><return><action>0</action><countryCode>ZR</countryCode><countryName>ZAIRE</countryName></return><return><action>0</action><countryCode>ZM</countryCode><countryName>ZAMBIA</countryName></return><return><action>0</action><countryCode>ZW</countryCode><countryName>ZIMBABWE</countryName></return></ns2:getCountryListResponse></S:Body></S:Envelope>";
		Map<String, Object> r = function.parseXml(xml);
		assertNotNull(r);
		Object env = r.get("Envelope");
		assertTrue(env instanceof Map);
		Object body = ((Map) env).get("Body");
		assertTrue(body instanceof Map);
		Object list = ((Map) body).get("getCountryListResponse");
		assertTrue(list instanceof Map);
		Object returns = ((Map) list).get("return");
		assertTrue(returns instanceof List);
		
	}
	
	@SuppressWarnings("rawtypes")
	@Test
	public void testParseXmlTokens(){
		String xml = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><tokens><token><resource_type>TOKEN</resource_type><created_at>2014-02-11T13:00:00-06:00</created_at><duration_sec>2592000</duration_sec><id>1</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>mytoken</token></token><token><resource_type>TOKEN</resource_type><created_at>2013-02-11T13:00:00-06:00</created_at><duration_sec>600</duration_sec><id>2</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>expired</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-11T13:00:00-06:00</created_at><duration_sec>2592000</duration_sec><id>4</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>noauths</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-17T17:45:56-06:00</created_at><duration_sec>50</duration_sec><id>5</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:44:12-06:00</created_at><duration_sec>100</duration_sec><id>510965786</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:01:18-06:00</created_at><duration_sec>100</duration_sec><id>964151326</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:32-06:00</created_at><duration_sec>100</duration_sec><id>1169038681</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:59:25-06:00</created_at><duration_sec>100</duration_sec><id>1412991672</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-17T17:45:56-06:00</created_at><duration_sec>100</duration_sec><id>1495727184</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-17T17:46:09-06:00</created_at><duration_sec>108000</duration_sec><id>1495727185</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>4466131fe67645cc7da0991edad1518b412f51f6</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:56:24-06:00</created_at><duration_sec>50</duration_sec><id>1495727186</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:40-06:00</created_at><duration_sec>100</duration_sec><id>1496501699</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:06:01-06:00</created_at><duration_sec>100</duration_sec><id>1784532418</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:56:24-06:00</created_at><duration_sec>100</duration_sec><id>1896764415</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:56:33-06:00</created_at><duration_sec>108000</duration_sec><id>1896764416</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>ed4abaf90147384fe86ed040f9a79a9c1cf8bd8a</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:56:33-06:00</created_at><duration_sec>108000</duration_sec><id>1896764417</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>4fc7cd5c92ff54b16963a4e2ea484ace67d65886</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:56:37-06:00</created_at><duration_sec>108000</duration_sec><id>1896764418</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>4b63d71059bd2eca74622b6a80eb829c72a27e75</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:59:25-06:00</created_at><duration_sec>50</duration_sec><id>1896764419</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:59:35-06:00</created_at><duration_sec>108000</duration_sec><id>1896764420</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>67a14552edadd5075c5cdea17bf3a6249d9c6b84</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:59:36-06:00</created_at><duration_sec>108000</duration_sec><id>1896764421</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>1509ea04b5eea13a8e884ffed19339c2f964b3cc</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T10:59:40-06:00</created_at><duration_sec>108000</duration_sec><id>1896764422</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>29cbcc2701b7b13d15ff14b3dfac7c7398b22899</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:01:18-06:00</created_at><duration_sec>50</duration_sec><id>1896764423</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:01:29-06:00</created_at><duration_sec>108000</duration_sec><id>1896764424</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>fdf79669271cacf3faf7bd087c25b2a94e9b4026</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:01:29-06:00</created_at><duration_sec>108000</duration_sec><id>1896764425</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>c085436391416d88d5166ea2d7dd4338dcd992bb</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:01:34-06:00</created_at><duration_sec>108000</duration_sec><id>1896764426</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>403727f609cf2c5065e101709e155e4512d4e67e</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:44:12-06:00</created_at><duration_sec>50</duration_sec><id>1896764427</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:44:25-06:00</created_at><duration_sec>108000</duration_sec><id>1896764428</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>0e24be17d9abdf9a5ac2141b0454a1240c2bd632</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:44:25-06:00</created_at><duration_sec>108000</duration_sec><id>1896764429</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>5cfafd1dfe2c76cf9a789ad791ba0227149a33e7</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-18T13:44:32-06:00</created_at><duration_sec>108000</duration_sec><id>1896764430</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>382ae2ff848cee31c5502d42dc51b8180522662b</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:05:29-06:00</created_at><duration_sec>50</duration_sec><id>1896764431</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:05:29-06:00</created_at><duration_sec>100</duration_sec><id>2051242261</id><requestor><resource_type>USER</resource_type><display_name>Carlos Soria</display_name><id>2</id><password>3749424d231afb107c5d61b71fd2b836ee77fd81</password><username>csoria</username></requestor><system><resource_type>SYSTEM</resource_type><description>El servidor de desarrollo</description><id>2</id><ip>127.0.0.1</ip><name>idlas50</name></system><token>new token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:05:34-06:00</created_at><duration_sec>108000</duration_sec><id>2051242262</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>aa23cba40fd2f0471a0398367a658307848fcd2c</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:06:01-06:00</created_at><duration_sec>50</duration_sec><id>2051242263</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:06:17-06:00</created_at><duration_sec>108000</duration_sec><id>2051242264</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>6f62132500fb37445d53af42ccd06d2a9db48346</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:06:17-06:00</created_at><duration_sec>108000</duration_sec><id>2051242265</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>869601e156896076ccfc314bc4c9654c93335746</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:06:24-06:00</created_at><duration_sec>108000</duration_sec><id>2051242266</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>4e4a7958a62bbf415e45dc2d4be20630d8a099e0</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:32-06:00</created_at><duration_sec>50</duration_sec><id>2051242267</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:35-06:00</created_at><duration_sec>108000</duration_sec><id>2051242268</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>fbd4fd2b27505a286a16e66819da8d9b825fe237</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:40-06:00</created_at><duration_sec>50</duration_sec><id>2051242269</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>token</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:57-06:00</created_at><duration_sec>108000</duration_sec><id>2051242270</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>038b43ec3df560d2d84d9a7cddc78f5a0c152c72</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:23:57-06:00</created_at><duration_sec>108000</duration_sec><id>2051242271</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>de76af1ee2b1dc209cc6d2ad1c468bcedee56f1f</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:24:05-06:00</created_at><duration_sec>108000</duration_sec><id>2051242272</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>2e770a7f50e57da924ee88f9cbea2ce1632c7826</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:24:30-06:00</created_at><duration_sec>108000</duration_sec><id>2051242273</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>5e50df6106a0611adc5330f3148572fe285e8eef</token></token><token><resource_type>TOKEN</resource_type><created_at>2014-02-19T11:24:31-06:00</created_at><duration_sec>108000</duration_sec><id>2051242274</id><requestor><resource_type>USER</resource_type><display_name>Administrador</display_name><id>1</id><password>7c6ccedb19f2947edfadec240c12554152449e0e</password><username>admin</username></requestor><system><resource_type>SYSTEM</resource_type><description>Mi maquina local</description><id>1</id><ip>127.0.0.1</ip><name>localhost</name></system><token>c842abf72aedc31af31f899b8f823d6febedf26c</token></token></tokens>";
		Map<String, Object> r = function.parseXml(xml);
		assertNotNull(r);
		Object root = r.get("tokens");
		assertTrue(root instanceof Map);
		Object tokens = ((Map) root).get("token");
		assertTrue(tokens instanceof List);
		Object tokenInfo = ((List) tokens).get(0);
		assertTrue(tokenInfo instanceof Map);
		Object value = ((Map) tokenInfo).get("resource_type");
		assertTrue(value instanceof String);
		Object sys = ((Map) tokenInfo).get("system");
		assertTrue(sys instanceof Map);
		Object ip = ((Map) sys).get("ip");
		assertTrue(ip instanceof String);
	}
	
	@Test
	public void testInsertNestedLevel(){
		assertEquals("uno[].dos.tres.cuatro.cinco", function.insertNestedLevel("uno.dos.tres.cuatro.cinco", 0));
		assertEquals("uno.dos[].tres.cuatro.cinco", function.insertNestedLevel("uno.dos.tres.cuatro.cinco", 1));
		assertEquals("uno.dos.tres[].cuatro.cinco", function.insertNestedLevel("uno.dos.tres.cuatro.cinco", 2));
		assertEquals("uno.dos.tres.cuatro[].cinco", function.insertNestedLevel("uno.dos.tres.cuatro.cinco", 3));
		assertEquals("uno.dos.tres.cuatro.cinco[]", function.insertNestedLevel("uno.dos.tres.cuatro.cinco", 4));
		assertEquals("uno.dos.tres.cuatro.cinco", function.insertNestedLevel("uno.dos.tres.cuatro.cinco", 5));
	}
	
	@Test
	public void testGetLevelName(){
		assertEquals("uno", function.getLevelName("uno.dos.tres.cuatro.cinco", 0));
		assertEquals("dos", function.getLevelName("uno.dos.tres.cuatro.cinco", 1));
		assertEquals("tres", function.getLevelName("uno.dos.tres.cuatro.cinco", 2));
		assertEquals("cuatro", function.getLevelName("uno.dos.tres.cuatro.cinco", 3));
		assertEquals("cinco", function.getLevelName("uno.dos.tres.cuatro.cinco", 4));
		assertNull(function.getLevelName("uno.dos.tres.cuatro.cinco", 5));
	}
	
	@Test
	public void testCountLevels(){
		assertEquals(0, function.countLevels("uno"));
		assertEquals(1, function.countLevels("uno.dos"));
		assertEquals(2, function.countLevels("uno.dos.tres"));
		assertEquals(3, function.countLevels("uno.dos.tres.cuatro"));
	}

}
